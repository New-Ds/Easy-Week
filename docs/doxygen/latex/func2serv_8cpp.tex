\doxysection{server/func2serv.cpp File Reference}
\hypertarget{func2serv_8cpp}{}\label{func2serv_8cpp}\index{server/func2serv.cpp@{server/func2serv.cpp}}
{\ttfamily \#include "{}func2serv.\+h"{}}\newline
{\ttfamily \#include $<$QString$>$}\newline
{\ttfamily \#include $<$QString\+List$>$}\newline
{\ttfamily \#include $<$QMap$>$}\newline
{\ttfamily \#include $<$QDebug$>$}\newline
{\ttfamily \#include $<$databasesingleton.\+h$>$}\newline
{\ttfamily \#include $<$QJson\+Array$>$}\newline
{\ttfamily \#include $<$QJson\+Object$>$}\newline
{\ttfamily \#include $<$QJson\+Document$>$}\newline
Include dependency graph for func2serv.\+cpp\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{func2serv_8cpp__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a99bd96103155e73697cc47518a5559a4}{parsing}} (QString input, int socdes)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a173db167f59671d56b49f5d7d11ef531}{auth}} (QString\+List log)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_ac87f1fa2fd8c6ee1a48c3a56a99b3275}{reg}} (QString\+List params)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a27ffe3af29c8442de4aa94a5e48d2345}{add\+\_\+product}} (QString\+List params)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a0a88fbccc63c8cc890ded3a20fb71e72}{get\+\_\+stat}} ()
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a6d4386c36a7ed61c61cf3d1bad354f27}{check\+\_\+task}} ()
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_aa70831eddff4b8ed7a04647778a35747}{menu\+\_\+export}} ()
\item 
void \mbox{\hyperlink{func2serv_8cpp_af1b6a57c9eed96cee280cce58342bed5}{fetch\+\_\+products\+\_\+from\+\_\+db}} (const QString \&user\+Id, QString\+List \&products)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a73b3ae758a8cf3621318d27cd1a17722}{get\+\_\+products}} (QString user\+Id)
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_ab8bda875989629df9b683e881296b32d}{get\+\_\+all\+\_\+users}} ()
\item 
int \mbox{\hyperlink{func2serv_8cpp_a8ebcc70a2024aab70883f094fc35849e}{get\+\_\+user\+\_\+count}} ()
\item 
int \mbox{\hyperlink{func2serv_8cpp_a4ddd067c5a29f76aead93c977a05113a}{get\+\_\+product\+\_\+count}} ()
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a2d521723770cde0e28bb41544394917b}{get\+\_\+stable\+\_\+stat}} ()
\item 
int \mbox{\hyperlink{func2serv_8cpp_a4d269e13002c5cded37bee9ade854d93}{get\+\_\+weekly\+\_\+logins}} ()
\item 
int \mbox{\hyperlink{func2serv_8cpp_a2d6f70d14e474616a4a16a72485c2f0e}{get\+\_\+monthly\+\_\+logins}} ()
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a8a2ae0ff8263d70f4e0f30d6b0d89af7}{get\+\_\+dynamic\+\_\+stat}} ()
\item 
QByte\+Array \mbox{\hyperlink{func2serv_8cpp_a6496e445a644cca89c6252f6e7adecb0}{add\+\_\+favorite\+\_\+ration}} (const QString\+List \&container)
\item 
bool \mbox{\hyperlink{func2serv_8cpp_a064e99d59eaa1d8cccef20b3192df015}{add\+\_\+ration\+\_\+to\+\_\+favorites}} (const QString \&user\+Id, const QString \&ration\+Id)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
QMap$<$ QString, QList$<$ QString $>$ $>$ \mbox{\hyperlink{func2serv_8cpp_aa13aef29ff8f58936aa8f2bd99f70253}{mock\+Database}}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{func2serv_8cpp_a6496e445a644cca89c6252f6e7adecb0}\index{func2serv.cpp@{func2serv.cpp}!add\_favorite\_ration@{add\_favorite\_ration}}
\index{add\_favorite\_ration@{add\_favorite\_ration}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{add\_favorite\_ration()}{add\_favorite\_ration()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a6496e445a644cca89c6252f6e7adecb0} 
QByte\+Array add\+\_\+favorite\+\_\+ration (\begin{DoxyParamCaption}\item[{const QString\+List \&}]{container}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00294\ \ \ \ \ QString\ userId\ =\ container[1];\ \textcolor{comment}{//\ ID\ пользователя}}
\DoxyCodeLine{00295\ \ \ \ \ QString\ rationId\ =\ container[2];\ \textcolor{comment}{//\ ID\ рациона}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \mbox{\hyperlink{func2serv_8cpp_a064e99d59eaa1d8cccef20b3192df015}{add\_ration\_to\_favorites}}(userId,\ rationId);\ \textcolor{comment}{//\ Вызов\ функции-\/заглушки}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Ration\ successfully\ added\ to\ favorites\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00301\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Error:\ failed\ to\ add\ ration\ to\ favorites\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00303\ \ \ \ \ \}}
\DoxyCodeLine{00304\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a27ffe3af29c8442de4aa94a5e48d2345}\index{func2serv.cpp@{func2serv.cpp}!add\_product@{add\_product}}
\index{add\_product@{add\_product}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{add\_product()}{add\_product()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a27ffe3af29c8442de4aa94a5e48d2345} 
QByte\+Array add\+\_\+product (\begin{DoxyParamCaption}\item[{QString\+List}]{params}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{if}\ (params.size()\ !=\ 9)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}add\_product//failed//Неверные\ аргументы\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{class_data_base_singleton}{DataBaseSingleton}}\ *db\ =\ \mbox{\hyperlink{class_data_base_singleton_ae1a24c20c524fd67554e1ffe66319ede}{DataBaseSingleton::getInstance}}();}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{int}\ userId\ =\ params[1].toInt();}
\DoxyCodeLine{00172\ \ \ \ \ QString\ name\ =\ params[2];}
\DoxyCodeLine{00173\ \textcolor{comment}{/*}}
\DoxyCodeLine{00174\ \textcolor{comment}{\ \ \ \ //\ Проверяем,\ существует\ ли\ уже\ такой\ продукт }}
\DoxyCodeLine{00175\ \textcolor{comment}{\ \ \ \ QSqlQuery\ checkQuery\ =\ db-\/>executeQuery( }}
\DoxyCodeLine{00176\ \textcolor{comment}{\ \ \ \ \ \ \ \ "{}SELECT\ id\ FROM\ products\ WHERE\ id\_user\ =\ :id\_user\ AND\ name\ =\ :name"{}, }}
\DoxyCodeLine{00177\ \textcolor{comment}{\ \ \ \ \ \ \ \ \{\{"{}:id\_user"{},\ userId\},\ \{"{}:name"{},\ name\}\} }}
\DoxyCodeLine{00178\ \textcolor{comment}{\ \ \ \ \ \ \ \ ); }}
\DoxyCodeLine{00179\ \textcolor{comment}{}}
\DoxyCodeLine{00180\ \textcolor{comment}{\ \ \ \ if\ (checkQuery.next())\ \{ }}
\DoxyCodeLine{00181\ \textcolor{comment}{\ \ \ \ \ \ \ \ return\ "{}add\_product//failed//Продукт\ уже\ существует\(\backslash\)r\(\backslash\)n"{}; }}
\DoxyCodeLine{00182\ \textcolor{comment}{\ \ \ \ \} }}
\DoxyCodeLine{00183\ \textcolor{comment}{*/}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//\ Добавляем\ продукт}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_a3fe2a5e1f41a408023066e8caf63b523}{addProduct}}(}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ userId,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ name,}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ params[3].toInt(),\ \textcolor{comment}{//\ proteins}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ params[4].toInt(),\ \textcolor{comment}{//\ fatness}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ params[5].toInt(),\ \textcolor{comment}{//\ carbs}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ params[6].toInt(),\ \textcolor{comment}{//\ weight}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ params[7].toInt(),\ \textcolor{comment}{//\ cost}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ params[8].toInt()\ \ \textcolor{comment}{//\ type}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordflow}{return}\ success\ ?\ \textcolor{stringliteral}{"{}add\_product//success\(\backslash\)r\(\backslash\)n"{}}\ :\ \textcolor{stringliteral}{"{}add\_product//failed//Ошибка\ БД\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00197\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a064e99d59eaa1d8cccef20b3192df015}\index{func2serv.cpp@{func2serv.cpp}!add\_ration\_to\_favorites@{add\_ration\_to\_favorites}}
\index{add\_ration\_to\_favorites@{add\_ration\_to\_favorites}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{add\_ration\_to\_favorites()}{add\_ration\_to\_favorites()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a064e99d59eaa1d8cccef20b3192df015} 
bool add\+\_\+ration\+\_\+to\+\_\+favorites (\begin{DoxyParamCaption}\item[{const QString \&}]{user\+Id}{, }\item[{const QString \&}]{ration\+Id}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00306\ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Adding\ ration\ for\ user:"{}}\ <<\ userId\ <<\ \textcolor{stringliteral}{"{},\ ration\ ID:"{}}\ <<\ rationId;}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Заглушка,\ потом\ заменить\ на\ SQL-\/запрос}}
\DoxyCodeLine{00308\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a173db167f59671d56b49f5d7d11ef531}\index{func2serv.cpp@{func2serv.cpp}!auth@{auth}}
\index{auth@{auth}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{auth()}{auth()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a173db167f59671d56b49f5d7d11ef531} 
QByte\+Array auth (\begin{DoxyParamCaption}\item[{QString\+List}]{log}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ Проверяем\ количество\ параметров}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ (log.size()\ <\ 3)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}auth\_failed//Недостаточно\ параметров\ для\ авторизации\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{class_data_base_singleton}{DataBaseSingleton}}*\ db\ =\ \mbox{\hyperlink{class_data_base_singleton_ae1a24c20c524fd67554e1ffe66319ede}{DataBaseSingleton::getInstance}}();}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{bool}\ authSuccess\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_a51bd7dc4507c5f3d04a2903899e13d42}{checkUserCredentials}}(log[1],\ log[2]);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{if}\ (!authSuccess)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}auth\_failed//Неверный\ логин\ или\ пароль\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ QSqlQuery\ query\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_a4aa9edfd87be83120492e7b5c8de6151}{executeQuery}}(}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ id,\ name,\ email,\ pass\ FROM\ users\ WHERE\ (email\ =\ :login\ OR\ name\ =\ :login)\ AND\ pass\ =\ :pass"{}},}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}:login"{}},\ log[1]\},\ \textcolor{comment}{//\ логин}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}:pass"{}},\ log[2]\}\ \ \ \textcolor{comment}{//\ пароль}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{if}\ (!query.next())\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}auth\_failed//Ошибка\ при\ получении\ данных\ пользователя\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ QString\ userId\ =\ query.value(\textcolor{stringliteral}{"{}id"{}}).toString();}
\DoxyCodeLine{00106\ \ \ \ \ QString\ userLogin\ =\ query.value(\textcolor{stringliteral}{"{}name"{}}).toString();}
\DoxyCodeLine{00107\ \ \ \ \ QString\ userEmail\ =\ query.value(\textcolor{stringliteral}{"{}email"{}}).toString();}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ QString\ response\ =\ QString(\textcolor{stringliteral}{"{}auth\_success//\%1//\%2//\%3\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .arg(userId)}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .arg(userLogin)}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .arg(userEmail);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{return}\ response.toUtf8();}
\DoxyCodeLine{00115\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a6d4386c36a7ed61c61cf3d1bad354f27}\index{func2serv.cpp@{func2serv.cpp}!check\_task@{check\_task}}
\index{check\_task@{check\_task}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{check\_task()}{check\_task()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a6d4386c36a7ed61c61cf3d1bad354f27} 
QByte\+Array check\+\_\+task (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Task\ was\ succesful\ completed\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00205\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_af1b6a57c9eed96cee280cce58342bed5}\index{func2serv.cpp@{func2serv.cpp}!fetch\_products\_from\_db@{fetch\_products\_from\_db}}
\index{fetch\_products\_from\_db@{fetch\_products\_from\_db}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{fetch\_products\_from\_db()}{fetch\_products\_from\_db()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_af1b6a57c9eed96cee280cce58342bed5} 
void fetch\+\_\+products\+\_\+from\+\_\+db (\begin{DoxyParamCaption}\item[{const QString \&}]{user\+Id}{, }\item[{QString\+List \&}]{products}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{func2serv_8cpp_aa13aef29ff8f58936aa8f2bd99f70253}{mockDatabase}}.contains(userId))\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ products\ =\ \mbox{\hyperlink{func2serv_8cpp_aa13aef29ff8f58936aa8f2bd99f70253}{mockDatabase}}[userId];}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_ab8bda875989629df9b683e881296b32d}\index{func2serv.cpp@{func2serv.cpp}!get\_all\_users@{get\_all\_users}}
\index{get\_all\_users@{get\_all\_users}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_all\_users()}{get\_all\_users()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_ab8bda875989629df9b683e881296b32d} 
QByte\+Array get\+\_\+all\+\_\+users (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00236\ \ \ \ \ QStringList\ users;}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{comment}{//\ fetch\_users\_from\_db(users);}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ QString\ response;}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ QString\&\ user\ :\ users)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ response\ +=\ user\ +\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{return}\ response.toUtf8();}
\DoxyCodeLine{00246\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a8a2ae0ff8263d70f4e0f30d6b0d89af7}\index{func2serv.cpp@{func2serv.cpp}!get\_dynamic\_stat@{get\_dynamic\_stat}}
\index{get\_dynamic\_stat@{get\_dynamic\_stat}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_dynamic\_stat()}{get\_dynamic\_stat()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a8a2ae0ff8263d70f4e0f30d6b0d89af7} 
QByte\+Array get\+\_\+dynamic\+\_\+stat (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordtype}{int}\ weeklyLogins\ =\ 0;}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordtype}{int}\ monthlyLogins\ =\ 0;}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ Получаем\ данные\ из\ БД\ (пока\ заглушки)}}
\DoxyCodeLine{00284\ \ \ \ \ weeklyLogins\ =\ \mbox{\hyperlink{func2serv_8cpp_a4d269e13002c5cded37bee9ade854d93}{get\_weekly\_logins}}();}
\DoxyCodeLine{00285\ \ \ \ \ monthlyLogins\ =\ \mbox{\hyperlink{func2serv_8cpp_a2d6f70d14e474616a4a16a72485c2f0e}{get\_monthly\_logins}}();}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{//\ Формируем\ строку\ ответа}}
\DoxyCodeLine{00288\ \ \ \ \ QString\ response\ =\ \textcolor{stringliteral}{"{}Logins\ per\ week:\ "{}}\ +\ QString::number(weeklyLogins)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}\ +}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Logins\ per\ month:\ "{}}\ +\ QString::number(monthlyLogins)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{return}\ response.toUtf8();}
\DoxyCodeLine{00292\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a2d6f70d14e474616a4a16a72485c2f0e}\index{func2serv.cpp@{func2serv.cpp}!get\_monthly\_logins@{get\_monthly\_logins}}
\index{get\_monthly\_logins@{get\_monthly\_logins}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_monthly\_logins()}{get\_monthly\_logins()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a2d6f70d14e474616a4a16a72485c2f0e} 
int get\+\_\+monthly\+\_\+logins (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{comment}{//\ Заглушка,\ пока\ без\ БД}}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{return}\ 312;\ \textcolor{comment}{//\ Примерное\ значение}}
\DoxyCodeLine{00278\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a4ddd067c5a29f76aead93c977a05113a}\index{func2serv.cpp@{func2serv.cpp}!get\_product\_count@{get\_product\_count}}
\index{get\_product\_count@{get\_product\_count}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_product\_count()}{get\_product\_count()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a4ddd067c5a29f76aead93c977a05113a} 
int get\+\_\+product\+\_\+count (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{comment}{//\ Здесь\ будет\ SQL-\/запрос,\ пока\ заглушка}}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{return}\ 732;\ \textcolor{comment}{//\ Примерное\ значение}}
\DoxyCodeLine{00255\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a73b3ae758a8cf3621318d27cd1a17722}\index{func2serv.cpp@{func2serv.cpp}!get\_products@{get\_products}}
\index{get\_products@{get\_products}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_products()}{get\_products()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a73b3ae758a8cf3621318d27cd1a17722} 
QByte\+Array get\+\_\+products (\begin{DoxyParamCaption}\item[{QString}]{user\+Id}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{class_data_base_singleton}{DataBaseSingleton}}*\ db\ =\ \mbox{\hyperlink{class_data_base_singleton_ae1a24c20c524fd67554e1ffe66319ede}{DataBaseSingleton::getInstance}}();}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{int}\ userIdInt\ =\ userId.toInt();}
\DoxyCodeLine{00219\ \ \ \ \ QVector<QVariantMap>\ products\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_a84fe7936dd15c077eff86d7884ce3049}{getProductsByUser}}(userIdInt);}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ QJsonArray\ jsonArray;}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ QVariantMap\&\ product\ :\ products)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ QJsonObject\ obj\ =\ QJsonObject::fromVariantMap(product);}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ jsonArray.append(obj);}
\DoxyCodeLine{00225\ \ \ \ \ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ QJsonDocument\ doc(jsonArray);}
\DoxyCodeLine{00228\ \ \ \ \ QByteArray\ jsonBytes\ =\ doc.toJson(QJsonDocument::Compact);}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Отправляем\ продукты\ в\ виде\ JSON:"{}}\ <<\ jsonBytes;}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{return}\ jsonBytes;}
\DoxyCodeLine{00233\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a2d521723770cde0e28bb41544394917b}\index{func2serv.cpp@{func2serv.cpp}!get\_stable\_stat@{get\_stable\_stat}}
\index{get\_stable\_stat@{get\_stable\_stat}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_stable\_stat()}{get\_stable\_stat()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a2d521723770cde0e28bb41544394917b} 
QByte\+Array get\+\_\+stable\+\_\+stat (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordtype}{int}\ userCount\ =\ 0;}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordtype}{int}\ productCount\ =\ 0;}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ userCount\ =\ \mbox{\hyperlink{func2serv_8cpp_a8ebcc70a2024aab70883f094fc35849e}{get\_user\_count}}();}
\DoxyCodeLine{00262\ \ \ \ \ productCount\ =\ \mbox{\hyperlink{func2serv_8cpp_a4ddd067c5a29f76aead93c977a05113a}{get\_product\_count}}();}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ Формируем\ строку\ ответа}}
\DoxyCodeLine{00265\ \ \ \ \ QString\ response\ =\ \textcolor{stringliteral}{"{}Users:\ "{}}\ +\ QString::number(userCount)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}\ +}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Products:\ "{}}\ +\ QString::number(productCount)\ +\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{return}\ response.toUtf8();}
\DoxyCodeLine{00269\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a0a88fbccc63c8cc890ded3a20fb71e72}\index{func2serv.cpp@{func2serv.cpp}!get\_stat@{get\_stat}}
\index{get\_stat@{get\_stat}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_stat()}{get\_stat()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a0a88fbccc63c8cc890ded3a20fb71e72} 
QByte\+Array get\+\_\+stat (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Your\ Statistic:\ null\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00201\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a8ebcc70a2024aab70883f094fc35849e}\index{func2serv.cpp@{func2serv.cpp}!get\_user\_count@{get\_user\_count}}
\index{get\_user\_count@{get\_user\_count}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_user\_count()}{get\_user\_count()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a8ebcc70a2024aab70883f094fc35849e} 
int get\+\_\+user\+\_\+count (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ Здесь\ будет\ SQL-\/запрос,\ пока\ заглушка}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{return}\ 152;\ \textcolor{comment}{//\ Примерное\ значение}}
\DoxyCodeLine{00250\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a4d269e13002c5cded37bee9ade854d93}\index{func2serv.cpp@{func2serv.cpp}!get\_weekly\_logins@{get\_weekly\_logins}}
\index{get\_weekly\_logins@{get\_weekly\_logins}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{get\_weekly\_logins()}{get\_weekly\_logins()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a4d269e13002c5cded37bee9ade854d93} 
int get\+\_\+weekly\+\_\+logins (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ Заглушка,\ пока\ без\ БД}}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordflow}{return}\ 78;\ \textcolor{comment}{//\ Примерное\ значение}}
\DoxyCodeLine{00273\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_aa70831eddff4b8ed7a04647778a35747}\index{func2serv.cpp@{func2serv.cpp}!menu\_export@{menu\_export}}
\index{menu\_export@{menu\_export}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{menu\_export()}{menu\_export()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_aa70831eddff4b8ed7a04647778a35747} 
QByte\+Array menu\+\_\+export (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Меню\ успешно\ экспортировано!\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00208\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_a99bd96103155e73697cc47518a5559a4}\index{func2serv.cpp@{func2serv.cpp}!parsing@{parsing}}
\index{parsing@{parsing}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{parsing()}{parsing()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_a99bd96103155e73697cc47518a5559a4} 
QByte\+Array parsing (\begin{DoxyParamCaption}\item[{QString}]{input}{, }\item[{int}]{socdes}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00019\ \{}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \ \ QStringList\ container\ =\ input.remove(\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}).split(\textcolor{stringliteral}{"{}//"{}});\ \textcolor{comment}{//пример\ входящих\ данных\ reg//login\_user//password\_user}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordflow}{if}\ (container.isEmpty())\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}server\ error:\ empty\ command\(\backslash\)\(\backslash\)n"{}};}
\DoxyCodeLine{00025\ \ \ \ \ \}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ qDebug()\ <<\ socdes\ <<\ \textcolor{stringliteral}{"{}\ user\ command:\ "{}}\ <<\ container[0];}
\DoxyCodeLine{00029\ \ \ \ \ QString\ var\ =\ container[0];}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}check\_task"{}})}
\DoxyCodeLine{00031\ \ \ \ \ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a6d4386c36a7ed61c61cf3d1bad354f27}{check\_task}}();}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\textcolor{stringliteral}{"{}auth"{}})}
\DoxyCodeLine{00035\ \ \ \ \ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a173db167f59671d56b49f5d7d11ef531}{auth}}(container);}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}add\_product"{}})}
\DoxyCodeLine{00039\ \ \ \ \ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a27ffe3af29c8442de4aa94a5e48d2345}{add\_product}}(container);}
\DoxyCodeLine{00041\ \ \ \ \ \}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}user"{}}\ \&\&\ container[2]\ ==\ \textcolor{stringliteral}{"{}get\_products"{}})\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a73b3ae758a8cf3621318d27cd1a17722}{get\_products}}(container[1]);}
\DoxyCodeLine{00044\ \ \ \ \ \}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\textcolor{stringliteral}{"{}reg"{}})}
\DoxyCodeLine{00046\ \ \ \ \ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_ac87f1fa2fd8c6ee1a48c3a56a99b3275}{reg}}(container);}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}get\_stat"{}})}
\DoxyCodeLine{00050\ \ \ \ \ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}(\mbox{\hyperlink{func2serv_8cpp_a0a88fbccc63c8cc890ded3a20fb71e72}{get\_stat}}());}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}admin"{}}\ \&\&\ container[1]\ ==\ \textcolor{stringliteral}{"{}dynamic\_stat"{}})\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a8a2ae0ff8263d70f4e0f30d6b0d89af7}{get\_dynamic\_stat}}();}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}menu\_export"{}})}
\DoxyCodeLine{00057\ \ \ \ \ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_aa70831eddff4b8ed7a04647778a35747}{menu\_export}}();}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}user"{}}\ \&\&\ container[2]\ ==\ \textcolor{stringliteral}{"{}add\_favorite\_ration"{}})\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a6496e445a644cca89c6252f6e7adecb0}{add\_favorite\_ration}}(container);}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}admin"{}}\ \&\&\ container[1]\ ==\ \textcolor{stringliteral}{"{}get\_all\_users"{}})\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_ab8bda875989629df9b683e881296b32d}{get\_all\_users}}();}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (var\ ==\ \textcolor{stringliteral}{"{}admin"{}}\ \&\&\ container[1]\ ==\ \textcolor{stringliteral}{"{}stable\_stat"{}})\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{func2serv_8cpp_a2d521723770cde0e28bb41544394917b}{get\_stable\_stat}}();}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00070\ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}server\ error:\ unknow\ command\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ \}}

\end{DoxyCode}
\Hypertarget{func2serv_8cpp_ac87f1fa2fd8c6ee1a48c3a56a99b3275}\index{func2serv.cpp@{func2serv.cpp}!reg@{reg}}
\index{reg@{reg}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{reg()}{reg()}}
{\footnotesize\ttfamily \label{func2serv_8cpp_ac87f1fa2fd8c6ee1a48c3a56a99b3275} 
QByte\+Array reg (\begin{DoxyParamCaption}\item[{QString\+List}]{params}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ 1️⃣\ Проверка\ количества\ параметров}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordflow}{if}\ (params.size()\ !=\ 4)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}reg\_failed//Недостаточно\ параметров\ для\ регистрации\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ 2️⃣\ Извлечение\ данных\ из\ запроса}}
\DoxyCodeLine{00125\ \ \ \ \ QString\ name\ =\ params[1];\ \ \ \ \ \ \textcolor{comment}{//\ Имя\ пользователя}}
\DoxyCodeLine{00126\ \ \ \ \ QString\ email\ =\ params[2];\ \ \ \ \ \textcolor{comment}{//\ Email\ (должен\ быть\ уникальным)}}
\DoxyCodeLine{00127\ \ \ \ \ QString\ password\ =\ params[3];\ \ \textcolor{comment}{//\ Пароль}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{class_data_base_singleton}{DataBaseSingleton}}*\ db\ =\ \mbox{\hyperlink{class_data_base_singleton_ae1a24c20c524fd67554e1ffe66319ede}{DataBaseSingleton::getInstance}}();}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ 3️⃣\ Проверка,\ не\ занят\ ли\ email}}
\DoxyCodeLine{00132\ \ \ \ \ QSqlQuery\ checkQuery\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_a4aa9edfd87be83120492e7b5c8de6151}{executeQuery}}(}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}SELECT\ id\ FROM\ users\ WHERE\ email\ =\ :email"{}},}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \{\{\textcolor{stringliteral}{"{}:email"{}},\ email\}\}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Если\ запрос\ не\ выполнился\ (ошибка\ БД)}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{if}\ (!checkQuery.exec())\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}reg\_failed//Ошибка\ при\ проверке\ email\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Если\ email\ уже\ существует\ (найдена\ запись)}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{if}\ (checkQuery.next())\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}reg\_failed//Пользователь\ с\ таким\ email\ уже\ зарегистрирован\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ 4️⃣\ Попытка\ добавить\ пользователя}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_af17db97dfc40b0fa48b3ed9abeacca76}{addUser}}(name,\ email,\ password,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 5️⃣\ Обновление\ статистики\ (увеличиваем\ счетчик\ регистраций)}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ QVariantMap\ stats\ =\ db-\/>\mbox{\hyperlink{class_data_base_singleton_aad20b90cdb02aab3df1f27a9e4f882a3}{getStatistics}}();}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ db-\/>\mbox{\hyperlink{class_data_base_singleton_ab2877d5184cd7af28f1ea3b31f523280}{updateStatistics}}(}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ stats[\textcolor{stringliteral}{"{}registrations"{}}].toInt()\ +\ 1,\ \ \textcolor{comment}{//\ +1\ новая\ регистрация}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ stats[\textcolor{stringliteral}{"{}visits"{}}].toInt(),\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Визиты\ без\ изменений}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ stats[\textcolor{stringliteral}{"{}generations"{}}].toInt()\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Генерации\ без\ изменений}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}reg\_success//Регистрация\ прошла\ успешно\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00159\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Если\ INSERT\ не\ сработал\ (например,\ из-\/за\ UNIQUE\ INDEX)}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}reg\_failed//Ошибка\ при\ регистрации\ (возможно,\ email\ уже\ занят)\(\backslash\)r\(\backslash\)n"{}};}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ \}}

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\Hypertarget{func2serv_8cpp_aa13aef29ff8f58936aa8f2bd99f70253}\index{func2serv.cpp@{func2serv.cpp}!mockDatabase@{mockDatabase}}
\index{mockDatabase@{mockDatabase}!func2serv.cpp@{func2serv.cpp}}
\doxysubsubsection{\texorpdfstring{mockDatabase}{mockDatabase}}
{\footnotesize\ttfamily \label{func2serv_8cpp_aa13aef29ff8f58936aa8f2bd99f70253} 
QMap$<$QString, QList$<$QString$>$ $>$ mock\+Database}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \{}
\DoxyCodeLine{\ \ \ \ \{\textcolor{stringliteral}{"{}1"{}},\ \{\textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}banana\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}}\}\},}
\DoxyCodeLine{\ \ \ \ \{\textcolor{stringliteral}{"{}2"{}},\ \{\textcolor{stringliteral}{"{}apple\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}grape\_11\_45\_12\_24"{}}\}\}}
\DoxyCodeLine{\ \ \ \ \}}

\end{DoxyCode}

\begin{DoxyCode}{0}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00013\ \ \ \ \ \{\textcolor{stringliteral}{"{}1"{}},\ \{\textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}banana\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}orange\_11\_45\_12\_24"{}}\}\},}
\DoxyCodeLine{00014\ \ \ \ \ \{\textcolor{stringliteral}{"{}2"{}},\ \{\textcolor{stringliteral}{"{}apple\_11\_45\_12\_24"{}},\ \textcolor{stringliteral}{"{}grape\_11\_45\_12\_24"{}}\}\}}
\DoxyCodeLine{00015\ \ \ \ \ \};}

\end{DoxyCode}
